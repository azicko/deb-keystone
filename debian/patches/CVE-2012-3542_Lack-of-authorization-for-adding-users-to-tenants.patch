Description: Lack of authorization for adding users to tenants
 Dolph Mathews reported a vulnerability in Keystone. When attempting to
 update a user's default tenant, Keystone will only partially deny the
 request when a user is not authorized to complete this action. The API
 responds with 401 Not Authorized and the user's default tenant is not
 changed. However, the user is still granted membership to this new
 tenant. The result is that any client that can reach the
 administrative API (deployed on port 35357, by default) can add any
 user to any tenant.
Origin: https://review.openstack.org/#/c/11869/
Bug-Debian: http://bugs.debian.org/686265

--- keystone-2012.1.1.orig/keystone/identity/core.py
+++ keystone-2012.1.1/keystone/identity/core.py
@@ -436,6 +436,7 @@ class UserController(wsgi.Application):
 
     def update_user_tenant(self, context, user_id, user):
         """Update the default tenant."""
+        self.assert_admin(context)
         # ensure that we're a member of that tenant
         tenant_id = user.get('tenantId')
         self.identity_api.add_user_to_tenant(context, tenant_id, user_id)
